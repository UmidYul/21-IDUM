<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ‚Äî 21-IDUM | –®–∫–æ–ª–∞ –≤ –§–µ—Ä–≥–∞–Ω–µ</title>
    <meta name="description"
        content="–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ —à–∫–æ–ª—ã 21-IDUM: —Å–æ–±—ã—Ç–∏—è, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤, –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö. –ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å–µ –∂–∏–∑–Ω–∏ –Ω–∞—à–µ–π —à–∫–æ–ª—ã!" />
    <meta name="keywords" content="–Ω–æ–≤–æ—Å—Ç–∏ 21-IDUM, —à–∫–æ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤, –§–µ—Ä–≥–∞–Ω–∞" />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://school-21.uz/news.html" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://school-21.uz/news.html" />
    <meta property="og:title" content="–ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ‚Äî 21-IDUM" />
    <meta property="og:description" content="–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏, —Å–æ–±—ã—Ç–∏—è –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —à–∫–æ–ª—ã 21-IDUM –≤ –§–µ—Ä–≥–∞–Ω–µ" />
    <meta property="og:image" content="https://school-21.uz/images/logo.png" />
    <meta property="og:locale" content="ru_RU" />
    <meta property="og:locale:alternate" content="uz_UZ" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://school-21.uz/news.html" />
    <meta name="twitter:title" content="–ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ‚Äî 21-IDUM" />
    <meta name="twitter:description" content="–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏, —Å–æ–±—ã—Ç–∏—è –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —à–∫–æ–ª—ã 21-IDUM –≤ –§–µ—Ä–≥–∞–Ω–µ" />
    <meta name="twitter:image" content="https://school-21.uz/images/logo.png" />

    <!-- Alternate languages -->
    <link rel="alternate" hreflang="ru" href="https://school-21.uz/news.html?lang=ru" />
    <link rel="alternate" hreflang="uz" href="https://school-21.uz/news.html?lang=uz" />
    <link rel="alternate" hreflang="x-default" href="https://school-21.uz/news.html" />

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" type="image/21idum" href="/images/logo.png">
    <link rel="stylesheet" href="/style.css">
    <style>
        .news-page {
            padding: 60px 0;
            background: #f8f9fa;
        }

        .announcements-section {
            padding: 60px 0;
            background: linear-gradient(135deg, #fff9f0 0%, #ffffff 100%);
        }

        .announcements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .news-card {
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .news-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .news-img {
            width: 100%;
            height: 240px;
            background-size: cover;
            background-position: center;
            background-color: #e5e7eb;
            position: relative;
        }

        .news-content {
            padding: 24px;
        }

        .news-title {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin: 0 0 12px 0;
            line-height: 1.4;
        }

        .news-excerpt {
            font-size: 15px;
            color: #6b7280;
            line-height: 1.6;
            margin: 0 0 16px 0;
        }

        .news-link {
            display: inline-flex;
            align-items: center;
            color: #2563eb;
            font-weight: 600;
            text-decoration: none;
            font-size: 14px;
            transition: gap 0.2s ease;
            gap: 4px;
        }

        .news-link:hover {
            gap: 8px;
        }

        .no-news,
        .error-message {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
            font-size: 18px;
        }

        .error-message {
            color: #ef4444;
        }

        .loading-spinner {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .news-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .news-img {
                height: 200px;
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container container">
            <a href="/" class="logo">21-<span>IDUM</span></a>
            <ul class="nav-links" id="navLinks">
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/about.html">–û —à–∫–æ–ª–µ</a></li>
                <li><a href="/schedule.html">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a></li>
                <li><a href="/calendar.html">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
                <li><a href="/gallery.html">–ì–∞–ª–µ—Ä–µ—è</a></li>
                <li><a href="/news.html" class="active">–ù–æ–≤–æ—Å—Ç–∏</a></li>
                <li><a href="/team.html">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏</a></li>
                <li><a href="/faq.html">FAQ</a></li>
            </ul>
            <button class="language-switch" id="languageSwitch">–†—É—Å—Å–∫–∏–π</button>
            <div class="burger-menu" id="burgerMenu">
                <div class="burger-line"></div>
                <div class="burger-line"></div>
                <div class="burger-line"></div>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title">–ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h1>
            <p class="page-subtitle">–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</p>
        </div>
    </section>

    <!-- Announcements Section -->
    <section class="announcements-section">
        <div class="container">
            <h2 class="section-title" style="margin-bottom: 20px;">üì¢ –í–∞–∂–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
            <div class="announcements-grid" id="announcementsContainer">
                <!-- –û–±—ä—è–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            <div class="loading-spinner" id="announcementsLoading">
                –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...
            </div>
        </div>
    </section>

    <!-- News Section -->
    <section class="news-page">
        <div class="container">
            <h2 class="section-title" style="margin-bottom: 20px;">üì∞ –ù–æ–≤–æ—Å—Ç–∏ —à–∫–æ–ª—ã</h2>
            <div class="news-grid" id="newsContainer">
                <!-- –ù–æ–≤–æ—Å—Ç–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            <div class="loading-spinner" id="newsLoading">
                –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>21-IDUM</h3>
                    <p>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∫–æ–ª–∞ ‚Ññ21 –≥–æ—Ä–æ–¥–∞ –ê–Ω–¥–∏–∂–∞–Ω–∞</p>
                </div>
                <div class="footer-column">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <ul class="footer-links">
                        <li>+998 (77) 453-55-50</li>
                        <li>info@21idum.uz</li>
                        <li>–≥. –§–∞—Ä–≥–æ–Ω–∞, —É–ª. –ö–æ–∫–∞–Ω–¥—Å–∫–∞—è, 56</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                    <ul class="footer-links">
                        <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="/about.html">–û —à–∫–æ–ª–µ</a></li>
                        <li><a href="/schedule.html">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a></li>
                        <li><a href="/calendar.html">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
                        <li><a href="/gallery.html">–ì–∞–ª–µ—Ä–µ—è</a></li>
                        <li><a href="/news.html">–ù–æ–≤–æ—Å—Ç–∏</a></li>
                        <li><a href="/faq.html">FAQ</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 –®–∫–æ–ª–∞ ‚Ññ21-IDUM. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script>
        let currentLang = 'ru';

        // Language Switcher
        const languageSwitch = document.getElementById('languageSwitch');
        languageSwitch.addEventListener('click', () => {
            currentLang = currentLang === 'ru' ? 'uz' : 'ru';
            languageSwitch.textContent = currentLang === 'ru' ? '–†—É—Å—Å–∫–∏–π' : 'O\'zbekcha';
            loadNews(currentLang);
            loadAnnouncements();
        });

        // Burger Menu
        const burgerMenu = document.getElementById('burgerMenu');
        const navLinks = document.getElementById('navLinks');
        burgerMenu.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            burgerMenu.classList.toggle('active');
        });

        // Load Announcements Function
        async function loadAnnouncements() {
            const container = document.getElementById('announcementsContainer');
            const loading = document.getElementById('announcementsLoading');

            loading.style.display = 'block';
            container.innerHTML = '';

            try {
                const response = await fetch('/api/announcements');
                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.json();
                loading.style.display = 'none';

                if (data.length === 0) {
                    container.innerHTML = '<p class="no-news">–û–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                    return;
                }

                const typeIcons = {
                    important: 'üì¢',
                    event: 'üéâ',
                    info: 'üìö',
                    achievement: 'üèÜ',
                    urgent: '‚ö†Ô∏è',
                    competition: 'üéØ'
                };

                const typeTitles = {
                    important: '–í–∞–∂–Ω–æ',
                    event: '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ',
                    info: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                    achievement: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ',
                    urgent: '–°—Ä–æ—á–Ω–æ',
                    competition: '–ö–æ–Ω–∫—É—Ä—Å'
                };

                data.forEach(item => {
                    const icon = typeIcons[item.type] || 'üì¢';
                    const badgeClass = `${item.type}-badge`;
                    const dateStr = new Date(item.date).toLocaleDateString('ru-RU', {
                        day: '2-digit',
                        month: 'long',
                        year: 'numeric'
                    });
                    const locationHtml = item.location ? `<span class="announcement-location">üìç ${item.location}</span>` : '';
                    const linkHtml = item.link ? `<a href="${item.link}" class="announcement-link">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É ‚Üí</a>` : '';

                    container.insertAdjacentHTML('beforeend', `
                        <div class="announcement-card ${item.type}">
                          <div class="announcement-icon">${icon}</div>
                          <div class="announcement-content">
                            <div class="announcement-badge ${badgeClass}">${typeTitles[item.type] || '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}</div>
                            <h3 class="announcement-title">${item.title}</h3>
                            <p class="announcement-text">${item.text}</p>
                            <div class="announcement-meta">
                              <span class="announcement-date">üìÖ ${dateStr}</span>
                              ${locationHtml}
                              ${linkHtml}
                            </div>
                          </div>
                        </div>
                    `);
                });
            } catch (error) {
                loading.style.display = 'none';
                container.innerHTML = '<p class="error-message">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
            }
        }

        // Load News Function
        async function loadNews(lang = 'ru') {
            const newsContainer = document.getElementById('newsContainer');
            const newsLoading = document.getElementById('newsLoading');

            newsLoading.style.display = 'block';
            newsContainer.innerHTML = '';

            try {
                const response = await fetch(`/api/news?lang=${lang}`);
                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.json();
                newsLoading.style.display = 'none';

                const newsList = data.news || [];

                if (newsList.length === 0) {
                    newsContainer.innerHTML = '<p class="no-news">–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                    return;
                }

                newsList.forEach(item => {
                    const newsCard = document.createElement('div');
                    newsCard.className = 'news-card';
                    newsCard.innerHTML = `
                        <div class="news-img" style="background-image: url('${item.coverUrl || '/images/news-placeholder.jpg'}');"></div>
                        <div class="news-content">
                            <h3 class="news-title">${item.title}</h3>
                            <p class="news-excerpt">${item.excerpt || ''}</p>
                        </div>
                    `;

                    const link = document.createElement('a');
                    link.href = '#';
                    link.className = 'news-link';
                    link.textContent = '–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ ‚Üí';
                    link.onclick = (e) => {
                        e.preventDefault();
                        openNewsModal(item);
                    };

                    newsCard.querySelector('.news-content').appendChild(link);
                    newsContainer.appendChild(newsCard);
                });
            } catch (error) {
                newsLoading.style.display = 'none';
                newsContainer.innerHTML = '<p class="error-message">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
            }
        }

        // Open news modal
        window.openNewsModal = function (item) {
            const modal = document.createElement('div');
            modal.className = 'news-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                padding: 20px;
                animation: fadeIn 0.3s ease;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                border-radius: 12px;
                max-width: 800px;
                width: 100%;
                max-height: 80vh;
                overflow-y: auto;
                padding: 30px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                position: relative;
            `;

            const closeBtn = document.createElement('button');
            closeBtn.style.cssText = `
                position: absolute;
                top: 15px;
                right: 15px;
                background: none;
                border: none;
                font-size: 28px;
                cursor: pointer;
                color: #999;
                padding: 0;
                width: 30px;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            closeBtn.textContent = '√ó';
            closeBtn.onclick = () => modal.remove();

            // Get title and content from API response (single language per request)
            const title = item.title || '';
            const body = item.content || '';

            let html = `<div style="display: flex; flex-direction: column; gap: 15px; padding-right: 40px;">`;

            // Title
            if (title) {
                html += `<h2 style="margin: 0; font-size: 28px; color: var(--text-dark); line-height: 1.3;">${title}</h2>`;
            }

            // Cover image
            if (item.coverUrl) {
                html += `<img src="${item.coverUrl}" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px;">`;
            }

            // Date
            let dateStr = '';
            if (item.publish_date) {
                // If already formatted as string
                if (typeof item.publish_date === 'string' && item.publish_date.includes('.')) {
                    dateStr = item.publish_date;
                } else {
                    // Parse date
                    const date = new Date(item.publish_date);
                    if (!isNaN(date.getTime())) {
                        dateStr = date.toLocaleDateString('ru-RU');
                    }
                }
            } else if (item.created_at) {
                const date = new Date(item.created_at);
                if (!isNaN(date.getTime())) {
                    dateStr = date.toLocaleDateString('ru-RU');
                }
            }

            if (dateStr) {
                html += `<div style="color: #999; font-size: 14px;">üìÖ ${dateStr}</div>`;
            }

            html += `<hr style="margin: 15px 0; border: none; border-top: 1px solid #e5e7eb;">`;

            // Main content
            if (body) {
                html += `<div style="line-height: 1.8; color: var(--text-dark);">${body}</div>`;
            } else {
                html += `<div style="color: #999;">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
            }

            html += `</div>`;

            content.innerHTML = html;
            content.appendChild(closeBtn);
            modal.appendChild(content);
            document.body.appendChild(modal);

            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        };

        // Load data on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadAnnouncements();
            loadNews(currentLang);
        });

        // Auto-refresh every 5 minutes
        setInterval(() => {
            loadAnnouncements();
            loadNews(currentLang);
        }, 5 * 60 * 1000);
    </script>

</body>

</html>
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ - 21-IDUM</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" type="image/21idum" href="/images/logo.png">
    <style>
        /* Spacing tweaks for schedule page */
        .schedule-section {
            padding: 60px 0 70px;
            background: #f8f9fa;
        }

        .schedule-grid {
            gap: 32px;
            align-items: stretch;
        }

        .schedule-content .schedule-item,
        .schedule-content .schedule-break {
            margin-bottom: 16px;
        }

        .events-list {
            display: flex;
            flex-direction: column;
            gap: 18px;
            max-height: none;
        }

        .schedule-card,
        .events-card {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .schedule-content,
        .events-list {
            flex: 1;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container container">
            <a href="/" class="logo">21-<span>IDUM</span></a>
            <ul class="nav-links" id="navLinks">
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/about.html">–û —à–∫–æ–ª–µ</a></li>
                <li><a href="/schedule.html" class="active">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a></li>
                <li><a href="/calendar.html">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
                <li><a href="/gallery.html">–ì–∞–ª–µ—Ä–µ—è</a></li>
                <li><a href="/news.html">–ù–æ–≤–æ—Å—Ç–∏</a></li>
                <li><a href="/team.html">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏</a></li>
                <li><a href="/faq.html">FAQ</a></li>
            </ul>
            <button class="language-switch" id="languageSwitch">–†—É—Å—Å–∫–∏–π</button>
            <div class="burger-menu" id="burgerMenu">
                <div class="burger-line"></div>
                <div class="burger-line"></div>
                <div class="burger-line"></div>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤</h1>
            <p class="page-subtitle">–î–≤–µ —Å–º–µ–Ω—ã –∏ –±–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</p>
        </div>
    </section>

    <!-- Schedule Section -->
    <section class="schedule-section" id="schedule">
        <div class="container">
            <div class="schedule-grid">
                <!-- School Time Schedule with Shift Switcher -->
                <div class="schedule-card">
                    <div class="schedule-header">
                        <span class="schedule-icon" id="shiftIcon">‚òÄÔ∏è</span>
                        <h3 id="shiftTitle">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤</h3>
                    </div>

                    <!-- Shift Switcher -->
                    <div class="shift-switcher">
                        <button class="shift-btn active" data-shift="first">
                            <span class="shift-emoji">‚òÄÔ∏è</span>
                            <span data-ru="–ü–µ—Ä–≤–∞—è —Å–º–µ–Ω–∞" data-uz="Birinchi smena">–ü–µ—Ä–≤–∞—è —Å–º–µ–Ω–∞</span>
                        </button>
                        <button class="shift-btn" data-shift="second">
                            <span class="shift-emoji">üåô</span>
                            <span data-ru="–í—Ç–æ—Ä–∞—è —Å–º–µ–Ω–∞" data-uz="Ikkinchi smena">–í—Ç–æ—Ä–∞—è —Å–º–µ–Ω–∞</span>
                        </button>
                    </div>

                    <!-- First Shift Content -->
                    <div class="schedule-content shift-content active" id="firstShift">
                        <div class="loading" data-ru="–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è..." data-uz="Jadval yuklanmoqda...">–ó–∞–≥—Ä—É–∑–∫–∞
                            —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
                    </div>

                    <!-- Second Shift Content -->
                    <div class="schedule-content shift-content" id="secondShift">
                        <div class="loading" data-ru="–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è..." data-uz="Jadval yuklanmoqda...">–ó–∞–≥—Ä—É–∑–∫–∞
                            —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
                    </div>
                </div>

                <!-- Upcoming Events -->
                <div class="events-card">
                    <div class="schedule-header">
                        <span class="schedule-icon">üîî</span>
                        <h3 data-ru="–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è" data-uz="Yaqinlashib kelayotgan tadbirlar">–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è
                        </h3>
                    </div>
                    <div class="events-list" id="eventsList">
                        <div class="loading" data-ru="–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π..." data-uz="Tadbirlar yuklanmoqda...">–ó–∞–≥—Ä—É–∑–∫–∞
                            —Å–æ–±—ã—Ç–∏–π...</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>21-IDUM</h3>
                    <p>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∫–æ–ª–∞ ‚Ññ21 –≥–æ—Ä–æ–¥–∞ –ê–Ω–¥–∏–∂–∞–Ω–∞</p>
                </div>
                <div class="footer-column">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <ul class="footer-links">
                        <li>+998 (77) 453-55-50</li>
                        <li>info@21idum.uz</li>
                        <li>–≥. –§–∞—Ä–≥–æ–Ω–∞, —É–ª. –ö–æ–∫–∞–Ω–¥—Å–∫–∞—è, 56</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                    <ul class="footer-links">
                        <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="/about.html">–û —à–∫–æ–ª–µ</a></li>
                        <li><a href="/schedule.html">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a></li>
                        <li><a href="/calendar.html">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
                        <li><a href="/gallery.html">–ì–∞–ª–µ—Ä–µ—è</a></li>
                        <li><a href="/news.html">–ù–æ–≤–æ—Å—Ç–∏</a></li>
                        <li><a href="/faq.html">FAQ</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p class="footer-credit">–°–∞–π—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–æ–º–∞–Ω–¥–æ–π <a href="/team.html">IDUM Dev</a></p>
                <p>&copy; 2025 –®–∫–æ–ª–∞ ‚Ññ21-IDUM. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script>
        // Language Management
        let currentLang = localStorage.getItem('language') || 'ru';
        const langBtns = document.querySelectorAll('.lang-btn');
        const languageSwitch = document.getElementById('languageSwitch');

        function updateLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            if (langBtns && langBtns.length) {
                langBtns.forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
                });
            }
            if (languageSwitch) {
                languageSwitch.textContent = lang === 'ru' ? 'O‚Äòzbekcha' : '–†—É—Å—Å–∫–∏–π';
            }
            document.querySelectorAll('[data-ru]').forEach(el => {
                el.textContent = el.getAttribute(`data-${lang}`);
            });
            loadBells();
            loadEvents();
        }

        if (langBtns && langBtns.length) {
            langBtns.forEach(btn => {
                btn.addEventListener('click', () => updateLanguage(btn.getAttribute('data-lang')));
            });
        }
        if (languageSwitch) {
            languageSwitch.addEventListener('click', () => {
                const nextLang = currentLang === 'ru' ? 'uz' : 'ru';
                updateLanguage(nextLang);
            });
        }

        // Initialize language
        updateLanguage(currentLang);

        // Load Bell Schedules
        async function loadBells() {
            try {
                const response = await fetch('/api/schedule/bells');
                const data = await response.json();
                const bells = data.bells || [];

                const firstShift = bells.find(b => b.shift === 1);
                const secondShift = bells.find(b => b.shift === 2);

                document.getElementById('firstShift').innerHTML = firstShift
                    ? renderBellSchedule(firstShift)
                    : `<div class="no-data" data-ru="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–µ—Ä–≤–æ–π —Å–º–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" data-uz="Birinchi smena uchun jadval topilmadi">${currentLang === 'ru' ? '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–µ—Ä–≤–æ–π —Å–º–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : 'Birinchi smena uchun jadval topilmadi'}</div>`;

                document.getElementById('secondShift').innerHTML = secondShift
                    ? renderBellSchedule(secondShift)
                    : `<div class="no-data" data-ru="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Ç–æ—Ä–æ–π —Å–º–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" data-uz="Ikkinchi smena uchun jadval topilmadi">${currentLang === 'ru' ? '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Ç–æ—Ä–æ–π —Å–º–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : 'Ikkinchi smena uchun jadval topilmadi'}</div>`;

            } catch (error) {
                const errorMsg = currentLang === 'ru'
                    ? '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è'
                    : 'Jadvalni yuklashda xato';
                document.getElementById('firstShift').innerHTML = `<div class="error">${errorMsg}</div>`;
                document.getElementById('secondShift').innerHTML = `<div class="error">${errorMsg}</div>`;
            }
        }

        function renderBellSchedule(schedule) {
            let lessonCount = 0;
            return schedule.lessons.map((lesson) => {
                if (lesson.isBreak) {
                    const breakLabel = currentLang === 'ru' ? '–ü–µ—Ä–µ–º–µ–Ω–∞' : 'Tanaffus';
                    return `
                                <div class="schedule-break">
                                    <div class="break-time">${lesson.time}</div>
                                    <div class="break-label">${breakLabel}</div>
                                </div>
                            `;
                } else {
                    lessonCount++;
                    const lessonName = currentLang === 'ru'
                        ? `${lessonCount}-–π —É—Ä–æ–∫`
                        : `${lessonCount}-dars`;
                    return `
                                <div class="schedule-item">
                                    <div class="schedule-time">${lesson.time}</div>
                                    <div class="schedule-label">${lessonName}</div>
                                </div>
                            `;
                }
            }).join('');
        }

        // Load Events
        async function loadEvents() {
            try {
                const response = await fetch('/api/schedule/events?upcoming=true&limit=10');
                const data = await response.json();
                const events = data.events || [];

                const eventsList = document.getElementById('eventsList');

                if (events.length === 0) {
                    eventsList.innerHTML = `<div class="no-data" data-ru="–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π –Ω–µ—Ç" data-uz="Yaqinlashib kelayotgan tadbirlar yo'q">${currentLang === 'ru' ? '–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π –Ω–µ—Ç' : 'Yaqinlashib kelayotgan tadbirlar yo\'q'}</div>`;
                    return;
                }

                eventsList.innerHTML = events.map(event => {
                    const eventDate = new Date(event.date);
                    const day = eventDate.getDate();
                    const month = eventDate.toLocaleDateString(currentLang === 'ru' ? 'ru-RU' : 'uz-UZ', { month: 'short' });
                    const title = currentLang === 'ru' ? event.title_ru : event.title_uz;
                    const location = currentLang === 'ru'
                        ? (event.location_ru || '')
                        : (event.location_uz || '');
                    const time = event.time || '';

                    const desc = [time, location].filter(Boolean).join(', ');

                    return `
                                <div class="event-item">
                                    <div class="event-date">
                                        <div class="event-day">${day}</div>
                                        <div class="event-month">${month}</div>
                                    </div>
                                    <div class="event-info">
                                        <h4 class="event-title">${title}</h4>
                                        ${desc ? `<p class="event-desc">${desc}</p>` : ''}
                                    </div>
                                </div>
                            `;
                }).join('');

            } catch (error) {
                const errorMsg = currentLang === 'ru'
                    ? '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π'
                    : 'Tadbirlarni yuklashda xato';
                document.getElementById('eventsList').innerHTML = `<div class="error">${errorMsg}</div>`;
            }
        }

        // Burger Menu
        const burgerMenu = document.getElementById('burgerMenu');
        const navLinks = document.getElementById('navLinks');
        burgerMenu.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            burgerMenu.classList.toggle('active');
        });

        // Shift switcher functionality
        const shiftBtns = document.querySelectorAll('.shift-btn');
        const shiftContents = document.querySelectorAll('.shift-content');
        const shiftIcon = document.getElementById('shiftIcon');

        shiftBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                const shift = this.getAttribute('data-shift');

                // Remove active class from all buttons and contents
                shiftBtns.forEach(b => b.classList.remove('active'));
                shiftContents.forEach(c => c.classList.remove('active'));

                // Add active class to clicked button
                this.classList.add('active');

                // Show corresponding content and update icon
                if (shift === 'first') {
                    document.getElementById('firstShift').classList.add('active');
                    shiftIcon.textContent = '‚òÄÔ∏è';
                } else {
                    document.getElementById('secondShift').classList.add('active');
                    shiftIcon.textContent = 'üåô';
                }
            });
        });
    </script>
</body>

</html>